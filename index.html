<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subtitle Timing Synchronizer + Sinhala Translation</title>

  <!-- ‚úÖ Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CLJE123NKC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-CLJE123NKC');
  </script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      min-height: 100vh;
      padding: 15px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
      padding: 30px;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
      font-size: 26px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 25px;
      font-size: 15px;
    }

    /* Upload section grid responsive */
    .upload-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 25px;
    }
    @media (max-width: 700px) {
      .upload-section { grid-template-columns: 1fr; }
    }

    .upload-box {
      border: 3px dashed #667eea;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      cursor: pointer;
      transition: 0.3s;
    }
    .upload-box:hover { border-color: #764ba2; background: #f8f9ff; }
    .upload-box.uploaded { border-color: #10b981; background: #f0fdf4; }
    .upload-box h3 { color: #333; margin-bottom: 8px; }
    .upload-box p { color: #666; font-size: 13px; margin-bottom: 10px; }

    .btn {
      border: none;
      border-radius: 10px;
      padding: 12px 25px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn-upload { background: #667eea; color: white; }
    .btn-upload:hover { background: #5568d3; }
    .btn-sync {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      font-size: 16px;
      padding: 15px 30px;
    }
    .btn-sync:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-download { background: #10b981; color: white; }
    .btn-download:hover { background: #059669; }

    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .status {
      border: 2px solid #3b82f6;
      background: #eff6ff;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .status.success { background: #f0fdf4; border-color: #10b981; color: #065f46; }
    .status.error { background: #fef2f2; border-color: #ef4444; color: #991b1b; }
    .status.warning { background: #fffbeb; border-color: #f59e0b; color: #92400e; }

    .preview {
      background: #f9fafb;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      display: none;
      font-size: 13px;
      overflow-y: auto;
      max-height: 250px;
    }
    input[type="file"] { display: none; }

    .optional-badge {
      background: #fbbf24;
      color: #fff;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé¨ Subtitle Timing Synchronizer</h1>
    <p class="subtitle">Original subtitle ‡∂ë‡∂ö Sinhala ‡∂ö‡∂≠‡∑è ‡∂∂‡∑É‡∂ß sync ‡∂ö‡∂ª‡∂Ω‡∑è translate ‡∑Ä‡∑ô‡∂± tool ‡∂ë‡∂ö</p>

    <div class="upload-section">
      <div class="upload-box" id="originalBox" onclick="document.getElementById('originalFile').click()">
        <h3>Original Subtitle</h3>
        <p>(‡∂ï‡∂±‡∑ë‡∂∏ ‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä‡∂ö timing)</p>
        <button class="btn btn-upload">üìÅ Upload</button>
        <div id="originalCheck" style="display:none;color:#10b981;">‚úì Uploaded</div>
        <input type="file" id="originalFile" accept=".srt" />
      </div>

      <div class="upload-box" id="translatedBox" onclick="document.getElementById('translatedFile').click()">
        <h3>Sinhala Subtitle <span class="optional-badge">Optional</span></h3>
        <p>(‡∂¥‡∂ª‡∑í‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∂ö‡∂Ω files)</p>
        <button class="btn btn-upload">üìÅ Upload</button>
        <div id="translatedCheck" style="display:none;color:#10b981;">‚úì Uploaded</div>
        <input type="file" id="translatedFile" accept=".srt" />
      </div>
    </div>

    <div id="statusBox" class="status" style="display:none;"></div>

    <div class="button-group">
      <button class="btn btn-sync" id="syncBtn" onclick="syncSubtitles()">üîÑ Sync</button>
      <button class="btn btn-download" id="downloadBtn" onclick="downloadOutput()" style="display:none;">‚¨áÔ∏è Download</button>
    </div>

    <div class="preview" id="previewBox">
      <pre id="previewText"></pre>
    </div>
  </div>

  <script>
    let originalContent = null;
    let translatedContent = null;
    let outputContent = null;

    const originalFile = document.getElementById("originalFile");
    const translatedFile = document.getElementById("translatedFile");

    originalFile.addEventListener("change", (e) => {
      readFile(e.target.files[0], (text) => {
        originalContent = text;
        document.getElementById("originalBox").classList.add("uploaded");
        document.getElementById("originalCheck").style.display = "block";
        showStatus("Original subtitle upload ‡∑Ä‡∑î‡∂´‡∑è ‚úì", "success");
      });
    });

    translatedFile.addEventListener("change", (e) => {
      readFile(e.target.files[0], (text) => {
        translatedContent = text;
        document.getElementById("translatedBox").classList.add("uploaded");
        document.getElementById("translatedCheck").style.display = "block";
        showStatus("Sinhala subtitle upload ‡∑Ä‡∑î‡∂´‡∑è ‚úì", "success");
      });
    });

    function readFile(file, callback) {
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => callback(e.target.result);
      reader.readAsText(file);
    }

    function parseSRT(content) {
      const blocks = content.trim().split(/\n\s*\n/);
      return blocks.map((block) => {
        const lines = block.split("\n");
        const index = lines[0];
        const timing = lines[1];
        const text = lines.slice(2).join("\n");
        return { index, timing, text };
      });
    }

    // üåê Google Translate (Sinhala)
    async function googleTranslateToSinhala(text) {
      try {
        const response = await fetch(
          `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=si&dt=t&q=${encodeURIComponent(text)}`
        );
        const data = await response.json();
        return data[0].map((t) => t[0]).join("");
      } catch {
        return text;
      }
    }

    async function syncSubtitles() {
      if (!originalContent) {
        showStatus("‚ö†Ô∏è Original subtitle ‡∂ë‡∂ö upload ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!", "error");
        return;
      }

      const btn = document.getElementById("syncBtn");
      btn.disabled = true;
      btn.textContent = "‚è≥ Processing...";

      try {
        const originalSubs = parseSRT(originalContent);
        let translatedSubs = translatedContent ? parseSRT(translatedContent) : [];

        const synced = [];
        for (let i = 0; i < originalSubs.length; i++) {
          if (translatedSubs[i]) {
            synced.push({
              index: i + 1,
              timing: originalSubs[i].timing,
              text: translatedSubs[i].text,
            });
          } else {
            const siText = await googleTranslateToSinhala(originalSubs[i].text);
            synced.push({
              index: i + 1,
              timing: originalSubs[i].timing,
              text: siText,
            });
          }
        }

        outputContent = synced.map((s) => `${s.index}\n${s.timing}\n${s.text}\n`).join("\n");
        document.getElementById("previewText").textContent = outputContent.slice(0, 1000) + "\n...";
        document.getElementById("previewBox").style.display = "block";
        document.getElementById("downloadBtn").style.display = "inline-block";
        showStatus(`‚úÖ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í! Subtitles ${synced.length}‡∂ö‡∑ä sync ‡∑Ä‡∑î‡∂´‡∑è.`, "success");
      } catch (e) {
        showStatus("‚ùå Error: " + e.message, "error");
      } finally {
        btn.disabled = false;
        btn.textContent = "üîÑ Sync";
      }
    }

    function downloadOutput() {
      if (!outputContent) return;
      const blob = new Blob([outputContent], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "synced_subtitles.srt";
      a.click();
      URL.revokeObjectURL(url);
    }

    function showStatus(msg, type) {
      const box = document.getElementById("statusBox");
      box.textContent = msg;
      box.className = "status " + type;
      box.style.display = "block";
    }
  </script>
</body>
</html>
